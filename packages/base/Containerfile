FROM ubuntu:24.04 as BUILDER

# Build depencencies
RUN apt update && \
    apt install -y meson wget build-essential ninja-build cmake-extras cmake gettext gettext-base fontconfig libfontconfig-dev libffi-dev libxml2-dev libdrm-dev libxkbcommon-x11-dev libxkbregistry-dev libxkbcommon-dev libpixman-1-dev libudev-dev libseat-dev seatd libxcb-dri3-dev libegl-dev libgles2 libegl1-mesa-dev glslang-tools libinput-bin libxcb-composite0-dev libavutil-dev libavcodec-dev libavformat-dev libxcb-ewmh2 libxcb-ewmh-dev libxcb-present-dev libxcb-icccm4-dev libxcb-render-util0-dev libxcb-res0-dev libxcb-xinput-dev libtomlplusplus3 libre2-dev xdg-desktop-portal-wlr git libpugixml-dev libwayland-dev wayland-protocols libgbm-dev hwdata scdoc libevdev-dev libmtdev-dev python3-pip libwacom-dev libgtk-3-dev clang-17 libc++-dev libc++abi-dev gcc-14 g++-14
# Install CMAKE > 3.30
RUN wget https://github.com/Kitware/CMake/releases/download/v3.30.3/cmake-3.30.3-linux-x86_64.tar.gz && tar -xzvf cmake-3.30.3-linux-x86_64.tar.gz && mv cmake-3.30.3-linux-x86_64 /opt/cmake-3.30.3 && ln -s /opt/cmake-3.30.3/bin/cmake /usr/local/bin/cmake && mkdir /deps

# Install Hyprland depencencies
WORKDIR /deps

RUN git clone https://gitlab.freedesktop.org/libinput/libinput.git && cd libinput && meson setup build && meson compile -C build && meson install -C build
RUN git clone https://gitlab.freedesktop.org/emersion/libdisplay-info.git && cd libdisplay-info && meson setup build && meson compile -C build && meson install -C build

RUN update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-14 140 \
    --slave /usr/bin/g++ g++ /usr/bin/g++-14 && \
    update-alternatives --config gcc

WORKDIR /hypr
