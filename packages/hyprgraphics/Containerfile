FROM hypr-builder:hyprwayland-scanner-latest as hyprwayland-scanner
FROM hypr-builder:hyprutils-latest as hyprutils
FROM hypr-builder:hyprlang-latest as hyprlang

FROM hypr-builder:base-latest as BUILDER

COPY --from=hyprwayland-scanner /opt/hyprwayland-scanner /opt/hyprwayland-scanner
COPY --from=hyprutils /opt/hyprutils /opt/hyprutils
COPY --from=hyprlang /opt/hyprlang /opt/hyprlang

ENV PATH="/opt/hyprlang/bin:/opt/hyprutils/bin:/opt/hyprwayland-scanner/bin:${PATH}"
ENV LD_LIBRARY_PATH="/opt/hyprlang/lib:/opt/hyprutils/lib:/opt/hyprwayland-scanner/lib:${LD_LIBRARY_PATH}"
ENV CMAKE_PREFIX_PATH="/opt/hyprlang:/opt/hyprutils:/opt/hyprwayland-scanner:${CMAKE_PREFIX_PATH}"
ENV PKG_CONFIG_PATH="/opt/hyprlang/lib/pkgconfig:/opt/aquamarine/lib/pkgconfig:${PKG_CONFIG_PATH}"

RUN echo "/opt/hyprlang/lib" > /etc/ld.so.conf.d/hyprlang.conf && ldconfig 

ARG DEPENDENCY=hyprgraphics

RUN git clone https://github.com/hyprwm/${DEPENDENCY}.git 

WORKDIR /hypr/${DEPENDENCY}

RUN cmake --no-warn-unused-cli -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/opt/${DEPENDENCY} -S . -B build \
 && cmake --build build --config Release --target all -j$(nproc 2>/dev/null || getconf _NPROCESSORS_CONF) \
 && cmake --install build

